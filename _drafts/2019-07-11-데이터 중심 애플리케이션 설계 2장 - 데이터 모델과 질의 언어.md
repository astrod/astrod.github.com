---
layout: post
title: "데이터 중심 애플리케이션 설계 2장 - 데이터 모델과 질의 언어.md"
tags:
- data
- book
category:
- data
---
* toc
{:toc}

# 데이터 모델과 질의 언어

데이터 모델은 소프트웨어가 어떻게 작성됐는지 뿐만 아니라, 해결하려는 문제를 **어떻게 생각해야 하는지** 에 대해서도 지대한 영향을 미친다.

대부분의 애플리케이션은 하나의 데이터 모델을 다른 데이터 모델 위에 계층을 둬서 만든다. 각 계층은 다른 계층과 데이터 표현을 통해 소통한다. 예를 들면

1. 애플리케이션은 클라이언트와 API 로 통신한다.
2. 데이터 구조는 JSON, XML, 문서, RDB로 저장된다.
3. 위의 데이터 구조들은 네트워크 바이트 단위로 저장되며, 이 바이트를 가지고 데이터를 질의, 탐색, 조작할 수 있다.

기본 개념은 다음과 같다.

> 각 계층은 명확한 데이터 모델을 제공해 하위 계층의 복잡성을 숨긴다.

이 장에서는 다양한 범용 데이터 모델을 살펴본다. 특히 관계형 모델, 문서 모델, 그래프 기반 데이터 모델을 비교한다.

# 관계형 모델과 문서 모델

관계형 데이터베이스의 근원은 1960년대와 70년대에 메인프레임 컴퓨터에서 수행된 비즈니스 데이터 처리에 있다. 보통 트렌젝션 처리와 배치 처리를 수행하였고, 오늘날에는 일반적인 데이터 처리 방식이다.

수 많은 모델들이 경쟁하였고, 1970년대에는 네트워크 모델과 계층 모델, 그리고 객체 데이터베이스, XML 데이터베이스가 나타났지만 관계형 데이터베이스는 위의 모델을 모두 무찌르고 현재 웹에서 볼 수 있는 대부분의 서비스에 사용되고 있다.

## NoSQL 의 탄생

NoSQL 은 다음과 같은 특징이 있다.

- 대규모 데이터셋이나 매우 높은 쓰기 처리량 달성을 관계형 데이터베이스보다 쉽게 할 수 있다
- 상용 데이터베이스 제품보다 무료 오픈소스가 많다.
- 관계형 모델에서 지원하지 않는 특수 질의가 가능하다.
- 동적이고 표현력이 풍부한 데이터 모델을 사용할 수 있다.

애플리케이션이 저마다 요구사항이 다르므로, 가까운 미래에는 관계형 데이터베이스와 요구사항을 충족시킬 수 있는 NoSQL 을 같이 사용하게 될 것이다. 이런 개념을 종종 polyglot persistence 라 한다.

## 객체 관계형 불일치

오늘날 대부분의 애플리케이션은 객체지향 프로그래밍 언어인데 반해, SQL 데이터 모델은 그렇지 않다. 따라서 데이터를 저장할 때 전환 계층이 필요하다. 이를 해결하기 위해 액티브레코드나 하이버네이트같은 ORM 프레임워크를 사용하기도 하지만, 두 모델 간의 차이를 완벽히 숨길 수는 없다.

예를 들면 링크드인 프로필을 저장한다고 했을 때, RDBMS 는 여러 테이블을 설계하여 그 테이블 사이의 관계를 가지고 데이터를 표현하게 된다. 하지만, 이력서 같은 데이터 구조는 모든 내용을 갖추고 있는 **문서** 라서, JSON 표현에 매우 적합하다.

~~~json
{
  "user_id":251,
  "first_name": "Bill",
  "last_name": "Gates",
  "summary": "Co-chair of the Bill & Melinda Gates... Active blogger.", 
  "region_id ": "us :91", 
  "industry_id": 131, 
  "photo_unl": "/p/7/000/253/05b/308dd6e.jpg",
  "positions": [ 
    {"job_title": "Co-chair ", "organization": " Bill & Melinda Gates Foundation"}, 
    {"job_title": "Co-founder, Chairman", "organization": "Microsoft"} 
  ], 
  "education": [ 
    {"school_name": " Harvard University ", "start": 1973, "end": 1975}, 
    {"school_name": "Lakeside School, Seattle", "start": null, "end": null} 
  ], 
  "contact_info": { 
    "blog": "http://thegatesnotes .com", 
    "twitter": "http:/Itwitter.comlBillGates" 
  }
 }
~~~

JSON 표현은 RDBMS 의 다중 테이블 스키마보다 더 나은 지역성을 갖는다. 관계형 테이블에서는 프로필을 가져오려면 여러 쿼리를 날리던지, 난잡한 다중 조인을 수행하여야 한다. JSON 모델은 모든 관련 정보가 한 곳에 있어, 질의 하나로 충분하다.
또한 사용자 프로필에서 직위, 학력 기록, 연락처 정보는 의미상 1:N 관계이다. 즉, 사용자 251은 N개의 직업을 가졌고, N 개의 학력이 있는 것이다.

## 다대일과 다대다 관계

위의 예제에서 region_id 와 industry_id 는 평문이 아니라 id 로 주어졌다. 평문이 아니라 아이디로 저장하면 다음과 같은 이점이 있다.

- 프로필 간 일관된 스타일과 철자
- 모호함 회피
- 갱신의 편의성
- 현지화 지원
- 더 나은 검색

핵심적인 것은 중복의 문제이다. ID 를 사용하는 경우, 사람에게 의미 있는 정보는 한 곳에만 저장하고 그것을 참조하는 모든 것은 ID 를 사용한다. ID 는 아무 의미가 없기 때문에, 식별 정보를 변경하여도 ID 는 동일하게 유지할 수 있다. 만약 정보가 중복되어 있다면, 정보 갱신시에 모든 정보를 갱신하여야 한다. 이것은 **쓰기 오버헤드와 불일치(일부 정보만 갱신됨)** 를 불러일으킬 위험이 있다.

중복된 데이터를 정규화하려면 RDBMS 처럼 many-to-one 관계가 필요한데, 이는 문서 모델에는 적합하지 않다. 또한 애플리케이션에 점점 기능을 추가하면 할수록, 데이터 사이에 관계가 발생하게 된다.

- 추천서 : 한 사용자가 다른 사용자를 추천한다고 가정하자. 추천받은 사용자의 추천서에서는 추천인의 이름과 사진을 확인할 수 있다. 추천인이 자신의 사진을 갱신하면 모든 추천서에도 사진이 갱신되어야 한다. 즉, 추천서는 추천인의 프로필을 참조한다.

## 문서 데이터베이스는 역사를 반복하고 있나?
